/**
 * @fileOverview Firestore Security Rules for the survey application.
 *
 * Core Philosophy:
 * This ruleset restricts read access to the `surveys` collection to authenticated administrators only, preventing unauthorized data access. Write access is completely disabled to prevent alteration or deletion of any survey data.
 *
 * Data Structure:
 * - All survey data is stored in the top-level `/surveys/{surveyId}` collection.
 *
 * Key Security Decisions:
 * - Only administrators can read the survey data, and the administrator are defined via email allowlisting.
 * - No users can create, update, or delete survey data.
 * - Schema validation is relaxed to allow rapid prototyping but should be tightened later.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls read access to survey documents, allowing only admins to read the data.
     * @path /surveys/{surveyId}
     * @allow (list) User with "apkelana@gmail.com" email is listing survey documents.
     * @deny (list) User with unlisted email is attempting to list survey documents.
     * @principle Restricts listing to administrators only.
     */
    match /surveys/{surveyId} {
      allow get: if isAdmin();
      allow list: if isAdmin();
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    // Helper function to check if the user is an admin based on their email.
    function isAdmin() {
        return isSignedIn() && request.auth.token.email == "apkelana@gmail.com";
    }

    // Helper function to check if the user is signed in.
    function isSignedIn() {
      return request.auth != null;
    }
  }
}